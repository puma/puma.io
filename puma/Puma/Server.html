<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Puma::Server &mdash; Puma-6.4.0</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Puma::Server",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Puma-6.4.0</a> &raquo; 
      <a href='../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../Puma.html" title="Puma (module)">Puma</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Server&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Puma::Server</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Request.html" title="Puma::Request (module)"><code>Request</code></a>,
          <a href="Const.html" title="Puma::Const (module)"><code>Const</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L31'>lib/puma/server.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The HTTP <code>Server</code> itself. Serves out a single <a href="Rack.html" title="Puma::Rack (module)"><code>Rack</code></a> app.</p>

<p>This class is used by the <a href="Single.html" title="Puma::Single (class)"><code>Single</code></a> and <a href="Cluster.html" title="Puma::Cluster (class)"><code>Cluster</code></a> classes to generate one or more <code>Server</code> instances capable of handling requests. Each Puma process will contain one <code>Server</code> instance.</p>

<p>The <code>Server</code> instance pulls requests from the socket, adds them to a <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> where they get eventually passed to a <a href="ThreadPool.html" title="Puma::ThreadPool (class)"><code>ThreadPool</code></a>.</p>

<p>Each <code>Server</code> will have one reactor and one thread pool.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='STAT_METHODS-constant' class='summary_signature'>STAT_METHODS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>List of methods invoked by <a href="#stats-instance_method" title="Puma::Server#stats (method)">#stats</a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Version:</p>
<ul class='version'>
  <li>
    <div class='inline'>
<p>5.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L625-L625'># File 'lib/puma/server.rb', line 625</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_running'><a href="#running-instance_method" title="Puma::Server#running (method)">running</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pool_capacity'><a href="#pool_capacity-instance_method" title="Puma::Server#pool_capacity (method)">pool_capacity</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_threads'><a href="#max_threads-instance_method" title="Puma::Server#max_threads (method)">max_threads</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_requests_count'><a href="#requests_count-instance_method" title="Puma::Server#requests_count (method)">requests_count</a></span>].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='THREAD_LOCAL_KEY-constant' class='summary_signature'>THREAD_LOCAL_KEY =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L49-L49'># File 'lib/puma/server.rb', line 49</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='id identifier rubyid_puma_server'>puma_server</span></pre>
  </li>
  <li>
    <span id='UNPACK_TCP_STATE_FROM_TCP_INFO-constant' class='summary_signature'>UNPACK_TCP_STATE_FROM_TCP_INFO =</span>
    <br/>
    <a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L181-L181'># File 'lib/puma/server.rb', line 181</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Const.html" title="Puma::Const (module)"><code>Const</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="Const.html#BANNED_HEADER_KEY-constant" title="Puma::Const::BANNED_HEADER_KEY (constant)">BANNED_HEADER_KEY</a>, 
    <a href="Const.html#CGI_VER-constant" title="Puma::Const::CGI_VER (constant)">CGI_VER</a>, 
    <a href="Const.html#CHUNKED-constant" title="Puma::Const::CHUNKED (constant)">CHUNKED</a>, 
    <a href="Const.html#CHUNK_SIZE-constant" title="Puma::Const::CHUNK_SIZE (constant)">CHUNK_SIZE</a>, 
    <a href="Const.html#CLOSE-constant" title="Puma::Const::CLOSE (constant)">CLOSE</a>, 
    <a href="Const.html#CLOSE_CHUNKED-constant" title="Puma::Const::CLOSE_CHUNKED (constant)">CLOSE_CHUNKED</a>, 
    <a href="Const.html#CODE_NAME-constant" title="Puma::Const::CODE_NAME (constant)">CODE_NAME</a>, 
    <a href="Const.html#COLON-constant" title="Puma::Const::COLON (constant)">COLON</a>, 
    <a href="Const.html#CONNECTION_CLOSE-constant" title="Puma::Const::CONNECTION_CLOSE (constant)">CONNECTION_CLOSE</a>, 
    <a href="Const.html#CONNECTION_KEEP_ALIVE-constant" title="Puma::Const::CONNECTION_KEEP_ALIVE (constant)">CONNECTION_KEEP_ALIVE</a>, 
    <a href="Const.html#CONTENT_LENGTH-constant" title="Puma::Const::CONTENT_LENGTH (constant)">CONTENT_LENGTH</a>, 
    <a href="Const.html#CONTENT_LENGTH2-constant" title="Puma::Const::CONTENT_LENGTH2 (constant)">CONTENT_LENGTH2</a>, 
    <a href="Const.html#CONTENT_LENGTH_S-constant" title="Puma::Const::CONTENT_LENGTH_S (constant)">CONTENT_LENGTH_S</a>, 
    <a href="Const.html#CONTINUE-constant" title="Puma::Const::CONTINUE (constant)">CONTINUE</a>, 
    <a href="Const.html#DQUOTE-constant" title="Puma::Const::DQUOTE (constant)">DQUOTE</a>, 
    <a href="Const.html#EARLY_HINTS-constant" title="Puma::Const::EARLY_HINTS (constant)">EARLY_HINTS</a>, 
    <a href="Const.html#ERROR_RESPONSE-constant" title="Puma::Const::ERROR_RESPONSE (constant)">ERROR_RESPONSE</a>, 
    <a href="Const.html#FAST_TRACK_KA_TIMEOUT-constant" title="Puma::Const::FAST_TRACK_KA_TIMEOUT (constant)">FAST_TRACK_KA_TIMEOUT</a>, 
    <a href="Const.html#GATEWAY_INTERFACE-constant" title="Puma::Const::GATEWAY_INTERFACE (constant)">GATEWAY_INTERFACE</a>, 
    <a href="Const.html#HALT_COMMAND-constant" title="Puma::Const::HALT_COMMAND (constant)">HALT_COMMAND</a>, 
    <a href="Const.html#HEAD-constant" title="Puma::Const::HEAD (constant)">HEAD</a>, 
    <a href="Const.html#HIJACK-constant" title="Puma::Const::HIJACK (constant)">HIJACK</a>, 
    <a href="Const.html#HIJACK_IO-constant" title="Puma::Const::HIJACK_IO (constant)">HIJACK_IO</a>, 
    <a href="Const.html#HIJACK_P-constant" title="Puma::Const::HIJACK_P (constant)">HIJACK_P</a>, 
    <a href="Const.html#HTTP-constant" title="Puma::Const::HTTP (constant)">HTTP</a>, 
    <a href="Const.html#HTTPS-constant" title="Puma::Const::HTTPS (constant)">HTTPS</a>, 
    <a href="Const.html#HTTPS_KEY-constant" title="Puma::Const::HTTPS_KEY (constant)">HTTPS_KEY</a>, 
    <a href="Const.html#HTTP_10_200-constant" title="Puma::Const::HTTP_10_200 (constant)">HTTP_10_200</a>, 
    <a href="Const.html#HTTP_11-constant" title="Puma::Const::HTTP_11 (constant)">HTTP_11</a>, 
    <a href="Const.html#HTTP_11_100-constant" title="Puma::Const::HTTP_11_100 (constant)">HTTP_11_100</a>, 
    <a href="Const.html#HTTP_11_200-constant" title="Puma::Const::HTTP_11_200 (constant)">HTTP_11_200</a>, 
    <a href="Const.html#HTTP_CONNECTION-constant" title="Puma::Const::HTTP_CONNECTION (constant)">HTTP_CONNECTION</a>, 
    <a href="Const.html#HTTP_EXPECT-constant" title="Puma::Const::HTTP_EXPECT (constant)">HTTP_EXPECT</a>, 
    <a href="Const.html#HTTP_HEADER_DELIMITER-constant" title="Puma::Const::HTTP_HEADER_DELIMITER (constant)">HTTP_HEADER_DELIMITER</a>, 
    <a href="Const.html#HTTP_HOST-constant" title="Puma::Const::HTTP_HOST (constant)">HTTP_HOST</a>, 
    <a href="Const.html#HTTP_VERSION-constant" title="Puma::Const::HTTP_VERSION (constant)">HTTP_VERSION</a>, 
    <a href="Const.html#HTTP_X_FORWARDED_FOR-constant" title="Puma::Const::HTTP_X_FORWARDED_FOR (constant)">HTTP_X_FORWARDED_FOR</a>, 
    <a href="Const.html#HTTP_X_FORWARDED_PROTO-constant" title="Puma::Const::HTTP_X_FORWARDED_PROTO (constant)">HTTP_X_FORWARDED_PROTO</a>, 
    <a href="Const.html#HTTP_X_FORWARDED_SCHEME-constant" title="Puma::Const::HTTP_X_FORWARDED_SCHEME (constant)">HTTP_X_FORWARDED_SCHEME</a>, 
    <a href="Const.html#HTTP_X_FORWARDED_SSL-constant" title="Puma::Const::HTTP_X_FORWARDED_SSL (constant)">HTTP_X_FORWARDED_SSL</a>, 
    <a href="Const.html#IANA_HTTP_METHODS-constant" title="Puma::Const::IANA_HTTP_METHODS (constant)">IANA_HTTP_METHODS</a>, 
    <a href="Const.html#ILLEGAL_HEADER_KEY_REGEX-constant" title="Puma::Const::ILLEGAL_HEADER_KEY_REGEX (constant)">ILLEGAL_HEADER_KEY_REGEX</a>, 
    <a href="Const.html#ILLEGAL_HEADER_VALUE_REGEX-constant" title="Puma::Const::ILLEGAL_HEADER_VALUE_REGEX (constant)">ILLEGAL_HEADER_VALUE_REGEX</a>, 
    <a href="Const.html#KEEP_ALIVE-constant" title="Puma::Const::KEEP_ALIVE (constant)">KEEP_ALIVE</a>, 
    <a href="Const.html#LINE_END-constant" title="Puma::Const::LINE_END (constant)">LINE_END</a>, 
    <a href="Const.html#LOCALHOST-constant" title="Puma::Const::LOCALHOST (constant)">LOCALHOST</a>, 
    <a href="Const.html#LOCALHOST_IPV4-constant" title="Puma::Const::LOCALHOST_IPV4 (constant)">LOCALHOST_IPV4</a>, 
    <a href="Const.html#LOCALHOST_IPV6-constant" title="Puma::Const::LOCALHOST_IPV6 (constant)">LOCALHOST_IPV6</a>, 
    <a href="Const.html#MAX_BODY-constant" title="Puma::Const::MAX_BODY (constant)">MAX_BODY</a>, 
    <a href="Const.html#MAX_HEADER-constant" title="Puma::Const::MAX_HEADER (constant)">MAX_HEADER</a>, 
    <a href="Const.html#NEWLINE-constant" title="Puma::Const::NEWLINE (constant)">NEWLINE</a>, 
    <a href="Const.html#PATH_INFO-constant" title="Puma::Const::PATH_INFO (constant)">PATH_INFO</a>, 
    <a href="Const.html#PORT_443-constant" title="Puma::Const::PORT_443 (constant)">PORT_443</a>, 
    <a href="Const.html#PORT_80-constant" title="Puma::Const::PORT_80 (constant)">PORT_80</a>, 
    <a href="Const.html#PROXY_PROTOCOL_V1_REGEX-constant" title="Puma::Const::PROXY_PROTOCOL_V1_REGEX (constant)">PROXY_PROTOCOL_V1_REGEX</a>, 
    <a href="Const.html#PUMA_CONFIG-constant" title="Puma::Const::PUMA_CONFIG (constant)">PUMA_CONFIG</a>, 
    <a href="Const.html#PUMA_PEERCERT-constant" title="Puma::Const::PUMA_PEERCERT (constant)">PUMA_PEERCERT</a>, 
    <a href="Const.html#PUMA_SERVER_STRING-constant" title="Puma::Const::PUMA_SERVER_STRING (constant)">PUMA_SERVER_STRING</a>, 
    <a href="Const.html#PUMA_SOCKET-constant" title="Puma::Const::PUMA_SOCKET (constant)">PUMA_SOCKET</a>, 
    <a href="Const.html#PUMA_TMP_BASE-constant" title="Puma::Const::PUMA_TMP_BASE (constant)">PUMA_TMP_BASE</a>, 
    <a href="Const.html#PUMA_VERSION-constant" title="Puma::Const::PUMA_VERSION (constant)">PUMA_VERSION</a>, 
    <a href="Const.html#QUERY_STRING-constant" title="Puma::Const::QUERY_STRING (constant)">QUERY_STRING</a>, 
    <a href="Const.html#RACK_AFTER_REPLY-constant" title="Puma::Const::RACK_AFTER_REPLY (constant)">RACK_AFTER_REPLY</a>, 
    <a href="Const.html#RACK_INPUT-constant" title="Puma::Const::RACK_INPUT (constant)">RACK_INPUT</a>, 
    <a href="Const.html#RACK_URL_SCHEME-constant" title="Puma::Const::RACK_URL_SCHEME (constant)">RACK_URL_SCHEME</a>, 
    <a href="Const.html#REMOTE_ADDR-constant" title="Puma::Const::REMOTE_ADDR (constant)">REMOTE_ADDR</a>, 
    <a href="Const.html#REQUEST_METHOD-constant" title="Puma::Const::REQUEST_METHOD (constant)">REQUEST_METHOD</a>, 
    <a href="Const.html#REQUEST_PATH-constant" title="Puma::Const::REQUEST_PATH (constant)">REQUEST_PATH</a>, 
    <a href="Const.html#REQUEST_URI-constant" title="Puma::Const::REQUEST_URI (constant)">REQUEST_URI</a>, 
    <a href="Const.html#RESTART_COMMAND-constant" title="Puma::Const::RESTART_COMMAND (constant)">RESTART_COMMAND</a>, 
    <a href="Const.html#SERVER_NAME-constant" title="Puma::Const::SERVER_NAME (constant)">SERVER_NAME</a>, 
    <a href="Const.html#SERVER_PORT-constant" title="Puma::Const::SERVER_PORT (constant)">SERVER_PORT</a>, 
    <a href="Const.html#SERVER_PROTOCOL-constant" title="Puma::Const::SERVER_PROTOCOL (constant)">SERVER_PROTOCOL</a>, 
    <a href="Const.html#SERVER_SOFTWARE-constant" title="Puma::Const::SERVER_SOFTWARE (constant)">SERVER_SOFTWARE</a>, 
    <a href="Const.html#STOP_COMMAND-constant" title="Puma::Const::STOP_COMMAND (constant)">STOP_COMMAND</a>, 
    <a href="Const.html#SUPPORTED_HTTP_METHODS-constant" title="Puma::Const::SUPPORTED_HTTP_METHODS (constant)">SUPPORTED_HTTP_METHODS</a>, 
    <a href="Const.html#TRANSFER_ENCODING-constant" title="Puma::Const::TRANSFER_ENCODING (constant)">TRANSFER_ENCODING</a>, 
    <a href="Const.html#TRANSFER_ENCODING2-constant" title="Puma::Const::TRANSFER_ENCODING2 (constant)">TRANSFER_ENCODING2</a>, 
    <a href="Const.html#TRANSFER_ENCODING_CHUNKED-constant" title="Puma::Const::TRANSFER_ENCODING_CHUNKED (constant)">TRANSFER_ENCODING_CHUNKED</a>, 
    <a href="Const.html#UNSPECIFIED_IPV4-constant" title="Puma::Const::UNSPECIFIED_IPV4 (constant)">UNSPECIFIED_IPV4</a>, 
    <a href="Const.html#UNSPECIFIED_IPV6-constant" title="Puma::Const::UNSPECIFIED_IPV6 (constant)">UNSPECIFIED_IPV6</a>, 
    <a href="Const.html#WRITE_TIMEOUT-constant" title="Puma::Const::WRITE_TIMEOUT (constant)">WRITE_TIMEOUT</a>
  </p>
  <h3 class='inherited'><a href="Request.html" title="Puma::Request (module)"><code>Request</code></a> - Included</h3>
  <p  class='inherited'>
    <a class='nodoc' href="Request.html#BODY_LEN_MAX-constant" title="Puma::Request::BODY_LEN_MAX (constant)">BODY_LEN_MAX</a>, 
    <a class='nodoc' href="Request.html#CUSTOM_STAT-constant" title="Puma::Request::CUSTOM_STAT (constant)">CUSTOM_STAT</a>, 
    <a class='nodoc' href="Request.html#IO_BODY_MAX-constant" title="Puma::Request::IO_BODY_MAX (constant)">IO_BODY_MAX</a>, 
    <a class='nodoc' href="Request.html#IO_BUFFER_LEN_MAX-constant" title="Puma::Request::IO_BUFFER_LEN_MAX (constant)">IO_BUFFER_LEN_MAX</a>, 
    <a class='nodoc' href="Request.html#SOCKET_WRITE_ERR_MSG-constant" title="Puma::Request::SOCKET_WRITE_ERR_MSG (constant)">SOCKET_WRITE_ERR_MSG</a>
  </p>
</div>

<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#current-class_method" title=".current (class method)">.<strong>current</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#closed_socket_supported%3F-class_method" title=".closed_socket_supported? (class method)">.<strong>closed_socket_supported?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#tcp_cork_supported%3F-class_method" title=".tcp_cork_supported? (class method)">.<strong>tcp_cork_supported?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(app, events = nil, options = {})  &#x21d2; Server </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a server for the rack app <a href="#app-instance_method" title="Puma::Server#app (method)">#app</a>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#app-instance_method" title="#app (instance method)">#<strong>app</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#auto_trim_time-instance_method" title="#auto_trim_time (instance method)">#<strong>auto_trim_time</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#backlog-instance_method" title="#backlog (instance method)">#<strong>backlog</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#binder-instance_method" title="#binder (instance method)">#<strong>binder</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#connected_ports-instance_method" title="#connected_ports (instance method)">#<strong>connected_ports</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#early_hints-instance_method" title="#early_hints (instance method)">#<strong>early_hints</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#events-instance_method" title="#events (instance method)">#<strong>events</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#first_data_timeout-instance_method" title="#first_data_timeout (instance method)">#<strong>first_data_timeout</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#leak_stack_on_error-instance_method" title="#leak_stack_on_error (instance method)">#<strong>leak_stack_on_error</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#log_writer-instance_method" title="#log_writer (instance method)">#<strong>log_writer</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#max_threads-instance_method" title="#max_threads (instance method)">#<strong>max_threads</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>for <a href="#stats-instance_method" title="Puma::Server#stats (method)">#stats</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#min_threads-instance_method" title="#min_threads (instance method)">#<strong>min_threads</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>for <a href="#stats-instance_method" title="Puma::Server#stats (method)">#stats</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#persistent_timeout-instance_method" title="#persistent_timeout (instance method)">#<strong>persistent_timeout</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#pool_capacity-instance_method" title="#pool_capacity (instance method)">#<strong>pool_capacity</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>This number represents the number of requests that the server is capable of taking right now.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#reaping_time-instance_method" title="#reaping_time (instance method)">#<strong>reaping_time</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#requests_count-instance_method" title="#requests_count (instance method)">#<strong>requests_count</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#running-instance_method" title="#running (instance method)">#<strong>running</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#shutting_down%3F-instance_method" title="#shutting_down? (instance method)">#<strong>shutting_down?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stats-instance_method" title="#stats (instance method)">#<strong>stats</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a hash of stats about the running server for reporting purposes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#thread-instance_method" title="#thread (instance method)">#<strong>thread</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#add_ssl_listener-instance_method" title="#add_ssl_listener (instance method)">#<strong>add_ssl_listener</strong>(host, port, ctx, optimize_for_latency = true, backlog = 1024)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#add_tcp_listener-instance_method" title="#add_tcp_listener (instance method)">#<strong>add_tcp_listener</strong>(host, port, optimize_for_latency = true, backlog = 1024)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#add_unix_listener-instance_method" title="#add_unix_listener (instance method)">#<strong>add_unix_listener</strong>(path, umask = nil, mode = nil, backlog = 1024)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#begin_restart-instance_method" title="#begin_restart (instance method)">#<strong>begin_restart</strong>(sync = false)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#client_error-instance_method" title="#client_error (instance method)">#<strong>client_error</strong>(e, client, requests = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Handle various error types thrown by <a href="Client.html" title="Puma::Client (class)"><code>Client</code></a> I/O operations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#closed_socket%3F-instance_method" title="#closed_socket? (instance method)">#<strong>closed_socket?</strong>(socket)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>See additional method definition at line 183.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cork_socket-instance_method" title="#cork_socket (instance method)">#<strong>cork_socket</strong>(socket)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>6 == <code>Socket::IPPROTO_TCP</code> 3 == TCP_CORK 1/0 == turn on/off.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#graceful_shutdown-instance_method" title="#graceful_shutdown (instance method)">#<strong>graceful_shutdown</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wait for all outstanding requests to finish.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#halt-instance_method" title="#halt (instance method)">#<strong>halt</strong>(sync = false)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#handle_servers-instance_method" title="#handle_servers (instance method)">#<strong>handle_servers</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inherit_binder-instance_method" title="#inherit_binder (instance method)">#<strong>inherit_binder</strong>(bind)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#lowlevel_error-instance_method" title="#lowlevel_error (instance method)">#<strong>lowlevel_error</strong>(e, env, status = 500)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>A fallback rack response if <tt>@app</tt> raises as exception.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#process_client-instance_method" title="#process_client (instance method)">#<strong>process_client</strong>(client)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Given a connection on <code>client</code>, handle the incoming requests, or queue the connection in the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> if no request is available.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reactor_wakeup-instance_method" title="#reactor_wakeup (instance method)">#<strong>reactor_wakeup</strong>(client)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This method is called from the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> thread when a queued <a href="Client.html" title="Puma::Client (class)"><code>Client</code></a> receives data, times out, or when the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> is shutting down.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>(background = true, thread_name: &#39;srv&#39;)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Runs the server.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>(sync = false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stops the acceptor thread and then causes the worker threads to finish off the request queue before finally exiting.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uncork_socket-instance_method" title="#uncork_socket (instance method)">#<strong>uncork_socket</strong>(socket)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>See additional method definition at line 164.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_force_shutdown-instance_method" title="#with_force_shutdown (instance method)">#<strong>with_force_shutdown</strong>(client, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Triggers a client timeout if the thread-pool shuts down during execution of the provided block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#notify_safely-instance_method" title="#notify_safely (instance method)">#<strong>notify_safely</strong>(message)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#response_to_error-instance_method" title="#response_to_error (instance method)">#<strong>response_to_error</strong>(client, requests, err, status_code)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#handle_check-instance_method" title="#handle_check (instance method)">#<strong>handle_check</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Request.html" title="Puma::Request (module)"><code>Request</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Request.html#default_server_port-instance_method" title="Puma::Request#default_server_port (method)">#default_server_port</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Request.html#handle_request-instance_method" title="Puma::Request#handle_request (method)">#handle_request</a></td>
      <td><div class='inline'><p>Takes the request contained in <code>client</code>, invokes the <a href="Rack.html" title="Puma::Rack (module)"><code>Rack</code></a> application to construct the response and writes it back to <code>client.io</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Request.html#prepare_response-instance_method" title="Puma::Request#prepare_response (method)">#prepare_response</a></td>
      <td><div class='inline'><p>Assembles the headers and prepares the body for actually sending the response via <code>#fast_write_response</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#fast_write_response-instance_method" title="Puma::Request#fast_write_response (method)">#fast_write_response</a></td>
      <td><div class='inline'><p>Used to write headers and body.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#fast_write_str-instance_method" title="Puma::Request#fast_write_str (method)">#fast_write_str</a></td>
      <td><div class='inline'><p>Used to write ‘early hints’, ‘no body’ responses, ‘hijacked’ responses, and body segments (called by <code>fast_write_response</code>).</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Request.html#fetch_status_code-instance_method" title="Puma::Request#fetch_status_code (method)">#fetch_status_code</a>,
        <a class='i_m priv nodoc' href="Request.html#illegal_header_key%3F-instance_method" title="Puma::Request#illegal_header_key? (method)">#illegal_header_key?</a>,
        <a class='i_m priv nodoc' href="Request.html#illegal_header_value%3F-instance_method" title="Puma::Request#illegal_header_value? (method)">#illegal_header_value?</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#normalize_env-instance_method" title="Puma::Request#normalize_env (method)">#normalize_env</a></td>
      <td><div class='inline'><p>Given a Hash <code>env</code> for the request read from <code>client</code>, add and fixup keys to comply with Rack’s env guidelines.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#req_env_post_parse-instance_method" title="Puma::Request#req_env_post_parse (method)">#req_env_post_parse</a></td>
      <td><div class='inline'><p>Fixup any headers with ‘,` in the name to have <code>_</code> now.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#str_early_hints-instance_method" title="Puma::Request#str_early_hints (method)">#str_early_hints</a></td>
      <td><div class='inline'><p>Used in the lambda for env[ <a href="Const.html#EARLY_HINTS-constant" title="Puma::Const::EARLY_HINTS (constant)">Const::EARLY_HINTS</a> ].</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Request.html#str_headers-instance_method" title="Puma::Request#str_headers (method)">#str_headers</a></td>
      <td><div class='inline'><p>Processes and write headers to the <a href="IOBuffer.html" title="Puma::IOBuffer (class)"><code>IOBuffer</code></a>.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(app, events = nil, options = {})  &#x21d2; <code>Server</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Several instance variables exist so they are available for testing, and have default values set via <code>fetch</code>.  Normally the values are set via ‘::Puma::Configuration.puma_default_options`.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The <a href="#events-instance_method" title="Puma::Server#events (method)">#events</a> parameter is set to nil, and set to <a href="Events.html#new-class_method" title="Puma::Events.new (method)">Events.new</a> in code. Often ‘options` needs to be passed, but <a href="#events-instance_method" title="Puma::Server#events (method)">#events</a> does not.  Using nil allows calling code to not require events.rb.</p>
</div>
  </div>


<p>Create a server for the rack app <a href="#app-instance_method" title="Puma::Server#app (method)">#app</a>.</p>

<p><a href="#log_writer-instance_method" title="Puma::Server#log_writer (method)">#log_writer</a> is a <a href="LogWriter.html" title="Puma::LogWriter (class)"><code>LogWriter</code></a> object used to log info and error messages.</p>

<p><a href="#events-instance_method" title="Puma::Server#events (method)">#events</a> is a <a href="Events.html" title="Puma::Events (class)"><code>Events</code></a> object used to notify application status events.</p>

<p><a href="#run-instance_method" title="Puma::Server#run (method)">#run</a> returns a thread that you can join on to wait for the server to do its work.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L68-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='68' data-end='120'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 68</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_app'><a href="#app-instance_method" title="Puma::Server#app (method)">app</a></span><span class='comma'>,</span> <span class='id identifier rubyid_events'><a href="#events-instance_method" title="Puma::Server#events (method)">events</a></span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Puma::Server#app (method)">app</a></span>
  <span class='ivar'>@events</span> <span class='op'>=</span> <span class='id identifier rubyid_events'><a href="#events-instance_method" title="Puma::Server#events (method)">events</a></span> <span class='op'>||</span> <span class='const'><a href="Events.html" title="Puma::Events (class)">Events</a></span>.<span class='id identifier rubyid_new'><a href="Events.html#new-class_method" title="Puma::Events.new (method)">new</a></span>

  <span class='ivar'>@check</span><span class='comma'>,</span> <span class='ivar'>@notify</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Puma::Server#stop (method)">stop</a></span>

  <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@thread_pool</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="UserFileDefaultOptions.html" title="Puma::UserFileDefaultOptions (class)">UserFileDefaultOptions</a></span>)
    <span class='id identifier rubyid_options'>options</span>
  <span class='kw'>else</span>
    <span class='const'><a href="UserFileDefaultOptions.html" title="Puma::UserFileDefaultOptions (class)">UserFileDefaultOptions</a></span>.<span class='id identifier rubyid_new'><a href="UserFileDefaultOptions.html#new-class_method" title="Puma::UserFileDefaultOptions.new (method)">new</a></span>(<span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='const'><a href="Configuration.html" title="Puma::Configuration (class)">Configuration</a></span><span class='op'>::</span><span class='const'><a href="Configuration.html#DEFAULTS-constant" title="Puma::Configuration::DEFAULTS (constant)">DEFAULTS</a></span>)
  <span class='kw'>end</span>

  <span class='ivar'>@log_writer</span>                <span class='op'>=</span> <span class='ivar'>@options</span>.<span class='id identifier rubyid_fetch'>fetch</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_writer'><a href="#log_writer-instance_method" title="Puma::Server#log_writer (method)">log_writer</a></span><span class='comma'>,</span> <span class='const'><a href="LogWriter.html" title="Puma::LogWriter (class)">LogWriter</a></span>.<span class='id identifier rubyid_stdio'><a href="LogWriter.html#stdio-class_method" title="Puma::LogWriter.stdio (method)">stdio</a></span>
  <span class='ivar'>@early_hints</span>               <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span>]
  <span class='ivar'>@first_data_timeout</span>        <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span>]
  <span class='ivar'>@persistent_timeout</span>        <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span>]
  <span class='ivar'>@idle_timeout</span>              <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_idle_timeout'>idle_timeout</span>]
  <span class='ivar'>@min_threads</span>               <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_min_threads'><a href="#min_threads-instance_method" title="Puma::Server#min_threads (method)">min_threads</a></span>]
  <span class='ivar'>@max_threads</span>               <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_threads'><a href="#max_threads-instance_method" title="Puma::Server#max_threads (method)">max_threads</a></span>]
  <span class='ivar'>@queue_requests</span>            <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_queue_requests'>queue_requests</span>]
  <span class='ivar'>@max_fast_inline</span>           <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_fast_inline'>max_fast_inline</span>]
  <span class='ivar'>@io_selector_backend</span>       <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_io_selector_backend'>io_selector_backend</span>]
  <span class='ivar'>@http_content_length_limit</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_http_content_length_limit'>http_content_length_limit</span>]

  <span class='comment'># make this a hash, since we prefer `key?` over `include?`
</span>  <span class='ivar'>@supported_http_methods</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_supported_http_methods'>supported_http_methods</span>] <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_any'>any</span>
      <span class='symbeg'>:</span><span class='id identifier rubyid_any'>any</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> (<span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_supported_http_methods'>supported_http_methods</span>])
        <span class='id identifier rubyid_ary'>ary</span>
      <span class='kw'>else</span>
        <span class='const'><a href="Const.html#SUPPORTED_HTTP_METHODS-constant" title="Puma::Const::SUPPORTED_HTTP_METHODS (constant)">SUPPORTED_HTTP_METHODS</a></span>
      <span class='kw'>end</span>.<span class='id identifier rubyid_sort'>sort</span>.<span class='id identifier rubyid_product'>product</span>([<span class='kw'>nil</span>]).<span class='id identifier rubyid_to_h'>to_h</span>.<span class='id identifier rubyid_freeze'>freeze</span>
    <span class='kw'>end</span>

  <span class='id identifier rubyid_temp'>temp</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span>(<span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>] <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(development|test)\z</span><span class='regexp_end'>/</span></span>)
  <span class='ivar'>@leak_stack_on_error</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>] <span class='op'>?</span> <span class='id identifier rubyid_temp'>temp</span> <span class='op'>:</span> <span class='kw'>true</span>

  <span class='ivar'>@binder</span> <span class='op'>=</span> <span class='const'><a href="Binder.html" title="Puma::Binder (class)">Binder</a></span>.<span class='id identifier rubyid_new'><a href="Binder.html#new-class_method" title="Puma::Binder.new (method)">new</a></span>(<span class='id identifier rubyid_log_writer'><a href="#log_writer-instance_method" title="Puma::Server#log_writer (method)">log_writer</a></span>)

  <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RACK_ENV</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>development</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@mode</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_http'>http</span>

  <span class='ivar'>@precheck_closing</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='ivar'>@requests_count</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="closed_socket_supported?-class_method">
  <h3 class='signature ro  nodoc first'>
    .<strong>closed_socket_supported?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Version:</p>
<ul class='version'>
  <li>
    <div class='inline'>
<p>5.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L140-L142'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='142'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed_socket_supported?'>closed_socket_supported?</span>
  <span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>TCP_INFO</span>) <span class='op'>&amp;&amp;</span> <span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>IPPROTO_TCP</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="current-class_method">
  <h3 class='signature ro'>
    .<strong>current</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L128-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='128' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 128</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_current'>current</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>[<span class='const'><a href="#THREAD_LOCAL_KEY-constant" title="Puma::Server::THREAD_LOCAL_KEY (constant)">THREAD_LOCAL_KEY</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tcp_cork_supported?-class_method">
  <h3 class='signature ro  nodoc'>
    .<strong>tcp_cork_supported?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Version:</p>
<ul class='version'>
  <li>
    <div class='inline'>
<p>5.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L134-L136'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='134' data-end='136'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_tcp_cork_supported?'>tcp_cork_supported?</span>
  <span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>TCP_CORK</span>) <span class='op'>&amp;&amp;</span> <span class='const'>Socket</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>IPPROTO_TCP</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="app-instance_method">
  <h3 class='signature rw first'>
    #<strong>app</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L46-L46'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='46' data-end='46'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 46</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app'>app</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="auto_trim_time-instance_method">
  <h3 class='signature ro'>
    #<strong>auto_trim_time</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'>auto_trim_time</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'><a href="#leak_stack_on_error-instance_method" title="Puma::Server#leak_stack_on_error (method)">leak_stack_on_error</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="backlog-instance_method">
  <h3 class='signature ro'>
    #<strong>backlog</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L206-L208'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='206' data-end='208'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 206</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_backlog'>backlog</span>
  <span class='ivar'>@thread_pool</span><span class='op'>&amp;.</span><span class='id identifier rubyid_backlog'>backlog</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="binder-instance_method">
  <h3 class='signature rw'>
    #<strong>binder</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L47-L47'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='47' data-end='47'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 47</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_binder'>binder</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connected_ports-instance_method">
  <h3 class='signature ro'>
    #<strong>connected_ports</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L652-L654'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='652' data-end='654'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 652</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connected_ports'>connected_ports</span>
  <span class='ivar'>@binder</span>.<span class='id identifier rubyid_connected_ports'>connected_ports</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="early_hints-instance_method">
  <h3 class='signature ro'>
    #<strong>early_hints</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'>early_hints</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'><a href="#leak_stack_on_error-instance_method" title="Puma::Server#leak_stack_on_error (method)">leak_stack_on_error</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="events-instance_method">
  <h3 class='signature ro'>
    #<strong>events</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L37-L37'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='37' data-end='37'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 37</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_events'>events</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="first_data_timeout-instance_method">
  <h3 class='signature ro'>
    #<strong>first_data_timeout</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'>first_data_timeout</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'><a href="#leak_stack_on_error-instance_method" title="Puma::Server#leak_stack_on_error (method)">leak_stack_on_error</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="leak_stack_on_error-instance_method">
  <h3 class='signature ro'>
    #<strong>leak_stack_on_error</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'>leak_stack_on_error</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="log_writer-instance_method">
  <h3 class='signature ro'>
    #<strong>log_writer</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L36-L36'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='36'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_writer'>log_writer</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_threads-instance_method">
  <h3 class='signature ro'>
    #<strong>max_threads</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>for <a href="#stats-instance_method" title="Puma::Server#stats (method)">#stats</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L38-L38'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='38' data-end='38'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 38</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_min_threads'><a href="#min_threads-instance_method" title="Puma::Server#min_threads (method)">min_threads</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_threads'>max_threads</span>  <span class='comment'># for #stats</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="min_threads-instance_method">
  <h3 class='signature ro'>
    #<strong>min_threads</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>for <a href="#stats-instance_method" title="Puma::Server#stats (method)">#stats</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L38-L38'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='38' data-end='38'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 38</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_min_threads'>min_threads</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_threads'><a href="#max_threads-instance_method" title="Puma::Server#max_threads (method)">max_threads</a></span>  <span class='comment'># for #stats</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="persistent_timeout-instance_method">
  <h3 class='signature ro'>
    #<strong>persistent_timeout</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'><a href="#leak_stack_on_error-instance_method" title="Puma::Server#leak_stack_on_error (method)">leak_stack_on_error</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'>persistent_timeout</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pool_capacity-instance_method">
  <h3 class='signature ro'>
    #<strong>pool_capacity</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This number represents the number of requests that the server is capable of taking right now.</p>

<p>For example if the number is 5 then it means there are 5 threads sitting idle ready to take a request. If one request comes in, then the value would be 4 until it finishes processing.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L224-L226'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='224' data-end='226'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 224</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pool_capacity'>pool_capacity</span>
  <span class='ivar'>@thread_pool</span><span class='op'>&amp;.</span><span class='id identifier rubyid_pool_capacity'>pool_capacity</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reaping_time-instance_method">
  <h3 class='signature ro'>
    #<strong>reaping_time</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>the following may be deprecated in the future</p>
</div>
  </div>


  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L42-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_early_hints'><a href="#early_hints-instance_method" title="Puma::Server#early_hints (method)">early_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_data_timeout'><a href="#first_data_timeout-instance_method" title="Puma::Server#first_data_timeout (method)">first_data_timeout</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_leak_stack_on_error'><a href="#leak_stack_on_error-instance_method" title="Puma::Server#leak_stack_on_error (method)">leak_stack_on_error</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_persistent_timeout'><a href="#persistent_timeout-instance_method" title="Puma::Server#persistent_timeout (method)">persistent_timeout</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'>reaping_time</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="requests_count-instance_method">
  <h3 class='signature ro'>
    #<strong>requests_count</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Version:</p>
<ul class='version'>
  <li>
    <div class='inline'>
<p>5.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L39-L39'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='39' data-end='39'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 39</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_requests_count'>requests_count</span>             <span class='comment'># @version 5.0.0</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="running-instance_method">
  <h3 class='signature ro'>
    #<strong>running</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L211-L213'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='213'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_running'>running</span>
  <span class='ivar'>@thread_pool</span><span class='op'>&amp;.</span><span class='id identifier rubyid_spawned'>spawned</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shutting_down?-instance_method">
  <h3 class='signature ro'>
    #<strong>shutting_down?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L619-L621'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='619' data-end='621'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 619</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shutting_down?'>shutting_down?</span>
  <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Puma::Server#stop (method)">stop</a></span> <span class='op'>||</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_restart'>restart</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats-instance_method">
  <h3 class='signature ro'>
    #<strong>stats</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a hash of stats about the running server for reporting purposes.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Version:</p>
<ul class='version'>
  <li>
    <div class='inline'>
<p>5.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L630-L632'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='630' data-end='632'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 630</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stats'>stats</span>
  <span class='const'><a href="#STAT_METHODS-constant" title="Puma::Server::STAT_METHODS (constant)">STAT_METHODS</a></span>.<span class='id identifier rubyid_map'>map</span> {<span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> [<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_name'>name</span>) <span class='op'>||</span> <span class='int'>0</span>]}.<span class='id identifier rubyid_to_h'>to_h</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread-instance_method">
  <h3 class='signature ro'>
    #<strong>thread</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L35-L35'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='35' data-end='35'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 35</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_thread'>thread</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="add_ssl_listener-instance_method">
  <h3 class='signature  first'>
    #<strong>add_ssl_listener</strong>(host, port, ctx, optimize_for_latency = true, backlog = 1024)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L642-L645'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='642' data-end='645'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 642</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_ssl_listener'>add_ssl_listener</span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_optimize_for_latency'>optimize_for_latency</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span> <span class='op'>=</span> <span class='int'>1024</span>)
  <span class='ivar'>@binder</span>.<span class='id identifier rubyid_add_ssl_listener'>add_ssl_listener</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_optimize_for_latency'>optimize_for_latency</span><span class='comma'>,</span> <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add_tcp_listener-instance_method">
  <h3 class='signature '>
    #<strong>add_tcp_listener</strong>(host, port, optimize_for_latency = true, backlog = 1024)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L638-L640'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='638' data-end='640'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 638</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_tcp_listener'>add_tcp_listener</span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_optimize_for_latency'>optimize_for_latency</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span> <span class='op'>=</span> <span class='int'>1024</span>)
  <span class='ivar'>@binder</span>.<span class='id identifier rubyid_add_tcp_listener'>add_tcp_listener</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_optimize_for_latency'>optimize_for_latency</span><span class='comma'>,</span> <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add_unix_listener-instance_method">
  <h3 class='signature '>
    #<strong>add_unix_listener</strong>(path, umask = nil, mode = nil, backlog = 1024)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L647-L649'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='647' data-end='649'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 647</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_unix_listener'>add_unix_listener</span>(<span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_umask'>umask</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span> <span class='op'>=</span> <span class='int'>1024</span>)
  <span class='ivar'>@binder</span>.<span class='id identifier rubyid_add_unix_listener'>add_unix_listener</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_umask'>umask</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="begin_restart-instance_method">
  <h3 class='signature '>
    #<strong>begin_restart</strong>(sync = false)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L614-L617'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='614' data-end='617'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 614</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_begin_restart'>begin_restart</span>(<span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>false</span>)
  <span class='id identifier rubyid_notify_safely'><a href="#notify_safely-instance_method" title="Puma::Server#notify_safely (method)">notify_safely</a></span>(<span class='const'><a href="Const.html#RESTART_COMMAND-constant" title="Puma::Const::RESTART_COMMAND (constant)">RESTART_COMMAND</a></span>)
  <span class='ivar'>@thread</span>.<span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='ivar'>@thread</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sync'>sync</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="client_error-instance_method">
  <h3 class='signature '>
    #<strong>client_error</strong>(e, client, requests = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Handle various error types thrown by <a href="Client.html" title="Puma::Client (class)"><code>Client</code></a> I/O operations.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L507-L525'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='507' data-end='525'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 507</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_client_error'>client_error</span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='comment'># Swallow, do not log
</span>  <span class='kw'>return</span> <span class='kw'>if</span> [<span class='const'><a href="ConnectionError.html" title="Puma::ConnectionError (class)">ConnectionError</a></span><span class='comma'>,</span> <span class='const'>EOFError</span>].<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span>)

  <span class='kw'>case</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>when</span> <span class='const'><a href="MiniSSL.html" title="Puma::MiniSSL (module)">MiniSSL</a></span><span class='op'>::</span><span class='const'><a href="MiniSSL/SSLError.html" title="Puma::MiniSSL::SSLError (class)">SSLError</a></span>
    <span class='id identifier rubyid_lowlevel_error'><a href="#lowlevel_error-instance_method" title="Puma::Server#lowlevel_error (method)">lowlevel_error</a></span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_env'>env</span>)
    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_ssl_error'>ssl_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_io'>io</span>
  <span class='kw'>when</span> <span class='const'><a href="HttpParserError.html" title="Puma::HttpParserError (class)">HttpParserError</a></span>
    <span class='id identifier rubyid_response_to_error'><a href="#response_to_error-instance_method" title="Puma::Server#response_to_error (method)">response_to_error</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='int'>400</span>)
    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_parse_error'>parse_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>
  <span class='kw'>when</span> <span class='const'><a href="HttpParserError501.html" title="Puma::HttpParserError501 (class)">HttpParserError501</a></span>
    <span class='id identifier rubyid_response_to_error'><a href="#response_to_error-instance_method" title="Puma::Server#response_to_error (method)">response_to_error</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='int'>501</span>)
    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_parse_error'>parse_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_response_to_error'><a href="#response_to_error-instance_method" title="Puma::Server#response_to_error (method)">response_to_error</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='int'>500</span>)
    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_unknown_error'>unknown_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Read</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="closed_socket?-instance_method">
  <h3 class='signature '>
    #<strong>closed_socket?</strong>(socket)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See additional method definition at line 183.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L200-L215'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='200' data-end='215'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 200</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed_socket?'>closed_socket?</span>(<span class='id identifier rubyid_socket'>socket</span>)
  <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_to_io'>to_io</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>TCPSocket</span>) <span class='op'>&amp;&amp;</span> <span class='ivar'>@precheck_closing</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_tcp_info'>tcp_info</span> <span class='op'>=</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_getsockopt'>getsockopt</span>(<span class='const'>Socket</span><span class='op'>::</span><span class='const'>IPPROTO_TCP</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>TCP_INFO</span>)
  <span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
    <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
    <span class='ivar'>@precheck_closing</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_state'>state</span> <span class='op'>=</span> <span class='id identifier rubyid_tcp_info'>tcp_info</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='const'><a href="#UNPACK_TCP_STATE_FROM_TCP_INFO-constant" title="Puma::Server::UNPACK_TCP_STATE_FROM_TCP_INFO (constant)">UNPACK_TCP_STATE_FROM_TCP_INFO</a></span>)[<span class='int'>0</span>]
    <span class='comment'># TIME_WAIT: 6, CLOSE: 7, CLOSE_WAIT: 8, LAST_ACK: 9, CLOSING: 11
</span>    (<span class='id identifier rubyid_state'>state</span> <span class='op'>&gt;=</span> <span class='int'>6</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>&lt;=</span> <span class='int'>9</span>) <span class='op'>||</span> <span class='id identifier rubyid_state'>state</span> <span class='op'>==</span> <span class='int'>11</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cork_socket-instance_method">
  <h3 class='signature '>
    #<strong>cork_socket</strong>(socket)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>6 == <code>Socket::IPPROTO_TCP</code> 3 == TCP_CORK 1/0 == turn on/off</p>

<p>See additional method definition at line 155.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L173-L180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='173' data-end='180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 173</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cork_socket'>cork_socket</span>(<span class='id identifier rubyid_socket'>socket</span>)
  <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_to_io'>to_io</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'>Socket</span><span class='op'>::</span><span class='const'>IPPROTO_TCP</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>TCP_CORK</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='kw'>if</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>TCPSocket</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
    <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="graceful_shutdown-instance_method">
  <h3 class='signature '>
    #<strong>graceful_shutdown</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wait for all outstanding requests to finish.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L557-L584'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='557' data-end='584'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 557</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_graceful_shutdown'>graceful_shutdown</span>
  <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_shutdown_debug'>shutdown_debug</span>]
    <span class='id identifier rubyid_threads'>threads</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_list'>list</span>
    <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_threads'>threads</span>.<span class='id identifier rubyid_size'>size</span>

    <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_pid'>pid</span>

    <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_syswrite'>syswrite</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: === Begin thread backtrace dump ===\n</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_threads'>threads</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_syswrite'>syswrite</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: Thread </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_total'>total</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_syswrite'>syswrite</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_backtrace'>backtrace</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_syswrite'>syswrite</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pid'>pid</span><span class='embexpr_end'>}</span><span class='tstring_content'>: === End thread backtrace dump ===\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_restart'>restart</span>
    <span class='ivar'>@binder</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@thread_pool</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_force_shutdown_after'>force_shutdown_after</span>]
      <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_shutdown'>shutdown</span> <span class='id identifier rubyid_timeout'>timeout</span>.<span class='id identifier rubyid_to_f'>to_f</span>
    <span class='kw'>else</span>
      <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_shutdown'>shutdown</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="halt-instance_method">
  <h3 class='signature '>
    #<strong>halt</strong>(sync = false)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L609-L612'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='609' data-end='612'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 609</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_halt'>halt</span>(<span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>false</span>)
  <span class='id identifier rubyid_notify_safely'><a href="#notify_safely-instance_method" title="Puma::Server#notify_safely (method)">notify_safely</a></span>(<span class='const'><a href="Const.html#HALT_COMMAND-constant" title="Puma::Const::HALT_COMMAND (constant)">HALT_COMMAND</a></span>)
  <span class='ivar'>@thread</span>.<span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='ivar'>@thread</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sync'>sync</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_check-instance_method">
  <h3 class='signature nodoc'>
    #<strong>handle_check</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L389-L405'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='389' data-end='405'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_check'>handle_check</span>
  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='ivar'>@check</span>.<span class='id identifier rubyid_read'>read</span>(<span class='int'>1</span>)

  <span class='kw'>case</span> <span class='id identifier rubyid_cmd'>cmd</span>
  <span class='kw'>when</span> <span class='const'><a href="Const.html#STOP_COMMAND-constant" title="Puma::Const::STOP_COMMAND (constant)">STOP_COMMAND</a></span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Puma::Server#stop (method)">stop</a></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='const'><a href="Const.html#HALT_COMMAND-constant" title="Puma::Const::HALT_COMMAND (constant)">HALT_COMMAND</a></span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_halt'><a href="#halt-instance_method" title="Puma::Server#halt (method)">halt</a></span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>when</span> <span class='const'><a href="Const.html#RESTART_COMMAND-constant" title="Puma::Const::RESTART_COMMAND (constant)">RESTART_COMMAND</a></span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_restart'>restart</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_servers-instance_method">
  <h3 class='signature '>
    #<strong>handle_servers</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L308-L386'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='308' data-end='386'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 308</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_servers'>handle_servers</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_check'>check</span> <span class='op'>=</span> <span class='ivar'>@check</span>
    <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> [<span class='id identifier rubyid_check'>check</span>] <span class='op'>+</span> <span class='ivar'>@binder</span>.<span class='id identifier rubyid_ios'>ios</span>
    <span class='id identifier rubyid_pool'>pool</span> <span class='op'>=</span> <span class='ivar'>@thread_pool</span>
    <span class='id identifier rubyid_queue_requests'>queue_requests</span> <span class='op'>=</span> <span class='ivar'>@queue_requests</span>
    <span class='id identifier rubyid_drain'>drain</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_drain_on_shutdown'>drain_on_shutdown</span>] <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='kw'>nil</span>

    <span class='id identifier rubyid_addr_send_name'>addr_send_name</span><span class='comma'>,</span> <span class='id identifier rubyid_addr_value'>addr_value</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remote_address'>remote_address</span>]
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>
      [<span class='symbeg'>:</span><span class='id identifier rubyid_peerip='>peerip=</span><span class='comma'>,</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remote_address_value'>remote_address_value</span>]]
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_header'>header</span>
      [<span class='symbeg'>:</span><span class='id identifier rubyid_remote_addr_header='>remote_addr_header=</span><span class='comma'>,</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remote_address_header'>remote_address_header</span>]]
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_proxy_protocol'>proxy_protocol</span>
      [<span class='symbeg'>:</span><span class='id identifier rubyid_expect_proxy_proto='>expect_proxy_proto=</span><span class='comma'>,</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remote_address_proxy_protocol'>remote_address_proxy_protocol</span>]]
    <span class='kw'>else</span>
      [<span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>]
    <span class='kw'>end</span>

    <span class='kw'>while</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_run'><a href="#run-instance_method" title="Puma::Server#run (method)">run</a></span> <span class='op'>||</span> (<span class='id identifier rubyid_drain'>drain</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_shutting_down?'><a href="#shutting_down%3F-instance_method" title="Puma::Server#shutting_down? (method)">shutting_down?</a></span>)
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_ios'>ios</span> <span class='op'>=</span> <span class='const'><a href="../IO.html" title="IO (class)">IO</a></span>.<span class='id identifier rubyid_select'>select</span> <span class='id identifier rubyid_sockets'>sockets</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> (<span class='id identifier rubyid_shutting_down?'><a href="#shutting_down%3F-instance_method" title="Puma::Server#shutting_down? (method)">shutting_down?</a></span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='ivar'>@idle_timeout</span>)
        <span class='kw'>unless</span> <span class='id identifier rubyid_ios'>ios</span>
          <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Puma::Server#stop (method)">stop</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_shutting_down?'><a href="#shutting_down%3F-instance_method" title="Puma::Server#shutting_down? (method)">shutting_down?</a></span>
          <span class='kw'>break</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_ios'>ios</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_sock'>sock</span> <span class='op'>==</span> <span class='id identifier rubyid_check'>check</span>
            <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_handle_check'><a href="#handle_check-instance_method" title="Puma::Server#handle_check (method)">handle_check</a></span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_pool'>pool</span>.<span class='id identifier rubyid_wait_until_not_full'>wait_until_not_full</span>
            <span class='id identifier rubyid_pool'>pool</span>.<span class='id identifier rubyid_wait_for_less_busy_worker'>wait_for_less_busy_worker</span>(<span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_wait_for_less_busy_worker'>wait_for_less_busy_worker</span>])

            <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='kw'>begin</span>
              <span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span>
            <span class='kw'>rescue</span> <span class='const'><a href="../IO.html" title="IO (class)">IO</a></span><span class='op'>::</span><span class='const'><a href="../IO/WaitReadable.html" title="IO::WaitReadable (module)">WaitReadable</a></span>
              <span class='kw'>next</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_drain'>drain</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_shutting_down?'><a href="#shutting_down%3F-instance_method" title="Puma::Server#shutting_down? (method)">shutting_down?</a></span>
            <span class='id identifier rubyid_pool'>pool</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="Client.html" title="Puma::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Client.html#new-class_method" title="Puma::Client.new (method)">new</a></span>(<span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='ivar'>@binder</span>.<span class='id identifier rubyid_env'>env</span>(<span class='id identifier rubyid_sock'>sock</span>)).<span class='id identifier rubyid_tap'>tap</span> { <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
              <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_listener'>listener</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>
              <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_http_content_length_limit'>http_content_length_limit</span> <span class='op'>=</span> <span class='ivar'>@http_content_length_limit</span>
              <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_addr_send_name'>addr_send_name</span><span class='comma'>,</span> <span class='id identifier rubyid_addr_value'>addr_value</span>) <span class='kw'>if</span> <span class='id identifier rubyid_addr_value'>addr_value</span>
            }
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EBADF</span>
        <span class='comment'># In the case that any of the sockets are unexpectedly close.
</span>        <span class='id identifier rubyid_raise'>raise</span>
      <span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_unknown_error'>unknown_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Listen loop</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Drained </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_drain'>drain</span><span class='embexpr_end'>}</span><span class='tstring_content'> additional connections.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_drain'>drain</span>
    <span class='ivar'>@events</span>.<span class='id identifier rubyid_fire'>fire</span> <span class='symbeg'>:</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='ivar'>@status</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_queue_requests'>queue_requests</span>
      <span class='ivar'>@queue_requests</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='ivar'>@reactor</span>.<span class='id identifier rubyid_shutdown'>shutdown</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_graceful_shutdown'><a href="#graceful_shutdown-instance_method" title="Puma::Server#graceful_shutdown (method)">graceful_shutdown</a></span> <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stop'><a href="#stop-instance_method" title="Puma::Server#stop (method)">stop</a></span> <span class='op'>||</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_restart'>restart</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_unknown_error'>unknown_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exception handling servers</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>ensure</span>
    <span class='comment'># Errno::EBADF is infrequently raised
</span>    [<span class='ivar'>@check</span><span class='comma'>,</span> <span class='ivar'>@notify</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EBADF</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@notify</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@check</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='ivar'>@events</span>.<span class='id identifier rubyid_fire'>fire</span> <span class='symbeg'>:</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_done'>done</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inherit_binder-instance_method">
  <h3 class='signature '>
    #<strong>inherit_binder</strong>(bind)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L122-L124'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='122' data-end='124'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 122</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inherit_binder'>inherit_binder</span>(<span class='id identifier rubyid_bind'>bind</span>)
  <span class='ivar'>@binder</span> <span class='op'>=</span> <span class='id identifier rubyid_bind'>bind</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="lowlevel_error-instance_method">
  <h3 class='signature '>
    #<strong>lowlevel_error</strong>(e, env, status = 500)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A fallback rack response if <tt>@app</tt> raises as exception.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L529-L546'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='529' data-end='546'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 529</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_lowlevel_error'>lowlevel_error</span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span><span class='op'>=</span><span class='int'>500</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_handler'>handler</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lowlevel_error_handler'>lowlevel_error_handler</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_handler'>handler</span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_handler'>handler</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_e'>e</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_handler'>handler</span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>2</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_handler'>handler</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_handler'>handler</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@leak_stack_on_error</span>
    <span class='id identifier rubyid_backtrace'>backtrace</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_backtrace'>backtrace</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;no backtrace available&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_backtrace'>backtrace</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>)
    [<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> {}<span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puma caught this error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>]]
  <span class='kw'>else</span>
    [<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> {}<span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>]]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="notify_safely-instance_method">
  <h3 class='signature priv'>
    #<strong>notify_safely</strong>(message)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L586-L598'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='586' data-end='598'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 586</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_notify_safely'>notify_safely</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='ivar'>@notify</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
<span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>NoMethodError</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EBADF</span>
  <span class='comment'># The server, in another thread, is shutting down
</span>  <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
<span class='kw'>rescue</span> <span class='const'>RuntimeError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='comment'># Temporary workaround for https://bugs.ruby-lang.org/issues/13239
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>IOError</span><span class='tstring_end'>&#39;</span></span>)
    <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_client-instance_method">
  <h3 class='signature '>
    #<strong>process_client</strong>(client)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given a connection on <code>client</code>, handle the incoming requests, or queue the connection in the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> if no request is available.</p>

<p>This method is called from a <a href="ThreadPool.html" title="Puma::ThreadPool (class)"><code>ThreadPool</code></a> worker thread.</p>

<p>This method supports HTTP Keep-Alive so it may, depending on if the client indicates that it supports keep alive, wait for another request before returning.</p>

<p>Return true if one or more requests were processed.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L417-L494'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='417' data-end='494'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 417</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_client'>process_client</span>(<span class='id identifier rubyid_client'>client</span>)
  <span class='comment'># Advertise this server into the thread
</span>  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Puma::Server.current (method)">current</a></span>[<span class='const'><a href="#THREAD_LOCAL_KEY-constant" title="Puma::Server::THREAD_LOCAL_KEY (constant)">THREAD_LOCAL_KEY</a></span>] <span class='op'>=</span> <span class='kw'>self</span>

  <span class='id identifier rubyid_clean_thread_locals'>clean_thread_locals</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_clean_thread_locals'>clean_thread_locals</span>]
  <span class='id identifier rubyid_close_socket'>close_socket</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_requests'>requests</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='ivar'>@queue_requests</span> <span class='op'>&amp;&amp;</span>
      <span class='op'>!</span><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_eagerly_finish'>eagerly_finish</span>

      <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_set_timeout'>set_timeout</span>(<span class='ivar'>@first_data_timeout</span>)
      <span class='kw'>if</span> <span class='ivar'>@reactor</span>.<span class='id identifier rubyid_add'>add</span> <span class='id identifier rubyid_client'>client</span>
        <span class='id identifier rubyid_close_socket'>close_socket</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_with_force_shutdown'><a href="#with_force_shutdown-instance_method" title="Puma::Server#with_force_shutdown (method)">with_force_shutdown</a></span>(<span class='id identifier rubyid_client'>client</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_finish'>finish</span>(<span class='ivar'>@first_data_timeout</span>)
    <span class='kw'>end</span>

    <span class='kw'>while</span> <span class='kw'>true</span>
      <span class='ivar'>@requests_count</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_handle_request'>handle_request</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span> <span class='op'>+</span> <span class='int'>1</span>)
      <span class='kw'>when</span> <span class='kw'>false</span>
        <span class='kw'>break</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async'>async</span>
        <span class='id identifier rubyid_close_socket'>close_socket</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>break</span>
      <span class='kw'>when</span> <span class='kw'>true</span>
        <span class='const'><a href="ThreadPool.html" title="Puma::ThreadPool (class)">ThreadPool</a></span>.<span class='id identifier rubyid_clean_thread_locals'><a href="ThreadPool.html#clean_thread_locals-class_method" title="Puma::ThreadPool.clean_thread_locals (method)">clean_thread_locals</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_clean_thread_locals'>clean_thread_locals</span>

        <span class='id identifier rubyid_requests'>requests</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='comment'># As an optimization, try to read the next request from the
</span>        <span class='comment'># socket for a short time before returning to the reactor.
</span>        <span class='id identifier rubyid_fast_check'>fast_check</span> <span class='op'>=</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_run'><a href="#run-instance_method" title="Puma::Server#run (method)">run</a></span>

        <span class='comment'># Always pass the client back to the reactor after a reasonable
</span>        <span class='comment'># number of inline requests if there are other requests pending.
</span>        <span class='id identifier rubyid_fast_check'>fast_check</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_requests'>requests</span> <span class='op'>&gt;=</span> <span class='ivar'>@max_fast_inline</span> <span class='op'>&amp;&amp;</span>
          <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_backlog'><a href="#backlog-instance_method" title="Puma::Server#backlog (method)">backlog</a></span> <span class='op'>&gt;</span> <span class='int'>0</span>

        <span class='id identifier rubyid_next_request_ready'>next_request_ready</span> <span class='op'>=</span> <span class='id identifier rubyid_with_force_shutdown'><a href="#with_force_shutdown-instance_method" title="Puma::Server#with_force_shutdown (method)">with_force_shutdown</a></span>(<span class='id identifier rubyid_client'>client</span>) <span class='kw'>do</span>
          <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_reset'>reset</span>(<span class='id identifier rubyid_fast_check'>fast_check</span>)
        <span class='kw'>end</span>

        <span class='kw'>unless</span> <span class='id identifier rubyid_next_request_ready'>next_request_ready</span>
          <span class='kw'>break</span> <span class='kw'>unless</span> <span class='ivar'>@queue_requests</span>
          <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_set_timeout'>set_timeout</span> <span class='ivar'>@persistent_timeout</span>
          <span class='kw'>if</span> <span class='ivar'>@reactor</span>.<span class='id identifier rubyid_add'>add</span> <span class='id identifier rubyid_client'>client</span>
            <span class='id identifier rubyid_close_socket'>close_socket</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='kw'>break</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_client_error'><a href="#client_error-instance_method" title="Puma::Server#client_error (method)">client_error</a></span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span>)
    <span class='comment'># The ensure tries to close client down
</span>    <span class='id identifier rubyid_requests'>requests</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_io_buffer'>io_buffer</span>.<span class='id identifier rubyid_reset'>reset</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_close_socket'>close_socket</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
      <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
      <span class='comment'># Already closed
</span>    <span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='ivar'>@log_writer</span>.<span class='id identifier rubyid_unknown_error'>unknown_error</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Client</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reactor_wakeup-instance_method">
  <h3 class='signature '>
    #<strong>reactor_wakeup</strong>(client)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This method is called from the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> thread when a queued <a href="Client.html" title="Puma::Client (class)"><code>Client</code></a> receives data, times out, or when the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> is shutting down.</p>

<p>It is responsible for ensuring that a request has been completely received before it starts to be processed by the <a href="ThreadPool.html" title="Puma::ThreadPool (class)"><code>ThreadPool</code></a>. This may be known as read buffering. If read buffering is not done, and no other read buffering is performed (such as by an application server such as nginx) then the application would be subject to a slow client attack.</p>

<p>For a graphical representation of how the request buffer works see <a href="https://github.com/puma/puma/blob/master/docs/architecture.md#connection-pipeline" target="_parent" title="architecture.md">architecture.md</a>.</p>

<p>The method checks to see if it has the full header and body with the <a href="Client.html#try_to_finish-instance_method" title="Puma::Client#try_to_finish (method)">Client#try_to_finish</a> method. If the full request has been sent, then the request is passed to the <a href="ThreadPool.html" title="Puma::ThreadPool (class)"><code>ThreadPool</code></a> (‘@thread_pool &lt;&lt; client`) so that a “worker thread” can pick up the request and begin to execute application logic. The Client is then removed from the reactor (return <code>true</code>).</p>

<p>If a client object times out, a 408 response is written, its connection is closed, and the object is removed from the reactor (return <code>true</code>).</p>

<p>If the <a href="Reactor.html" title="Puma::Reactor (class)"><code>Reactor</code></a> is shutting down, all Clients are either timed out or passed to the <a href="ThreadPool.html" title="Puma::ThreadPool (class)"><code>ThreadPool</code></a>, depending on their current state (#can_close?).</p>

<p>Otherwise, if the full request is not ready then the client will remain in the reactor (return <code>false</code>). When the client sends more data to the socket the <a href="Client.html" title="Puma::Client (class)"><code>Client</code></a> object will wake up and again be checked to see if it’s ready to be passed to the thread pool.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L292-L306'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='292' data-end='306'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 292</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reactor_wakeup'>reactor_wakeup</span>(<span class='id identifier rubyid_client'>client</span>)
  <span class='id identifier rubyid_shutdown'>shutdown</span> <span class='op'>=</span> <span class='op'>!</span><span class='ivar'>@queue_requests</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_try_to_finish'>try_to_finish</span> <span class='op'>||</span> (<span class='id identifier rubyid_shutdown'>shutdown</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_can_close?'>can_close?</span>)
    <span class='ivar'>@thread_pool</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_client'>client</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_shutdown'>shutdown</span> <span class='op'>||</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout!'>timeout!</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_set_timeout'>set_timeout</span>(<span class='ivar'>@first_data_timeout</span>)
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='const'><a href="../StandardError.html" title="StandardError (class)">StandardError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_client_error'><a href="#client_error-instance_method" title="Puma::Server#client_error (method)">client_error</a></span>(<span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>)
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="response_to_error-instance_method">
  <h3 class='signature priv'>
    #<strong>response_to_error</strong>(client, requests, err, status_code)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L548-L552'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='548' data-end='552'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 548</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_response_to_error'>response_to_error</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_status_code'>status_code</span>)
  <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_res_body'>res_body</span> <span class='op'>=</span> <span class='id identifier rubyid_lowlevel_error'><a href="#lowlevel_error-instance_method" title="Puma::Server#lowlevel_error (method)">lowlevel_error</a></span>(<span class='id identifier rubyid_err'>err</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid_status_code'>status_code</span>)
  <span class='id identifier rubyid_prepare_response'>prepare_response</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_res_body'>res_body</span><span class='comma'>,</span> <span class='id identifier rubyid_requests'>requests</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span>)
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_write_error'>write_error</span>(<span class='id identifier rubyid_status_code'>status_code</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>(background = true, thread_name: &#39;srv&#39;)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Runs the server.</p>

<p>If <code>background</code> is true (the default) then a thread is spun up in the background to handle requests. Otherwise requests are handled synchronously.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L234-L265'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='234' data-end='265'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 234</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>(<span class='id identifier rubyid_background'>background</span><span class='op'>=</span><span class='kw'>true</span><span class='comma'>,</span> <span class='label'>thread_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>srv</span><span class='tstring_end'>&#39;</span></span>)
  <span class='const'>BasicSocket</span>.<span class='id identifier rubyid_do_not_reverse_lookup'>do_not_reverse_lookup</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='ivar'>@events</span>.<span class='id identifier rubyid_fire'>fire</span> <span class='symbeg'>:</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_booting'>booting</span>

  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_run'>run</span>

  <span class='ivar'>@thread_pool</span> <span class='op'>=</span> <span class='const'><a href="ThreadPool.html" title="Puma::ThreadPool (class)">ThreadPool</a></span>.<span class='id identifier rubyid_new'><a href="ThreadPool.html#new-class_method" title="Puma::ThreadPool.new (method)">new</a></span>(<span class='id identifier rubyid_thread_name'>thread_name</span><span class='comma'>,</span> <span class='ivar'>@options</span>) { <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span> <span class='id identifier rubyid_process_client'><a href="#process_client-instance_method" title="Puma::Server#process_client (method)">process_client</a></span> <span class='id identifier rubyid_client'>client</span> }

  <span class='kw'>if</span> <span class='ivar'>@queue_requests</span>
    <span class='ivar'>@reactor</span> <span class='op'>=</span> <span class='const'><a href="Reactor.html" title="Puma::Reactor (class)">Reactor</a></span>.<span class='id identifier rubyid_new'><a href="Reactor.html#new-class_method" title="Puma::Reactor.new (method)">new</a></span>(<span class='ivar'>@io_selector_backend</span>) { <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_reactor_wakeup'><a href="#reactor_wakeup-instance_method" title="Puma::Server#reactor_wakeup (method)">reactor_wakeup</a></span> <span class='id identifier rubyid_c'>c</span> }
    <span class='ivar'>@reactor</span>.<span class='id identifier rubyid_run'>run</span>
  <span class='kw'>end</span>


  <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_auto_reap!'>auto_reap!</span> <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_reaping_time'><a href="#reaping_time-instance_method" title="Puma::Server#reaping_time (method)">reaping_time</a></span>]
  <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_auto_trim!'>auto_trim!</span> <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_trim_time'><a href="#auto_trim_time-instance_method" title="Puma::Server#auto_trim_time (method)">auto_trim_time</a></span>]

  <span class='ivar'>@check</span><span class='comma'>,</span> <span class='ivar'>@notify</span> <span class='op'>=</span> <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_pipe'><a href="Util.html#pipe-class_method" title="Puma::Util.pipe (method)">pipe</a></span> <span class='kw'>unless</span> <span class='ivar'>@notify</span>

  <span class='ivar'>@events</span>.<span class='id identifier rubyid_fire'>fire</span> <span class='symbeg'>:</span><span class='id identifier rubyid_state'>state</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_running'><a href="#running-instance_method" title="Puma::Server#running (method)">running</a></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_background'>background</span>
    <span class='ivar'>@thread</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Puma::Server.new (method)">new</a></span> <span class='kw'>do</span>
      <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span>.<span class='id identifier rubyid_set_thread_name'><a href="../Puma.html#set_thread_name-class_method" title="Puma.set_thread_name (method)">set_thread_name</a></span> <span class='id identifier rubyid_thread_name'>thread_name</span>
      <span class='id identifier rubyid_handle_servers'><a href="#handle_servers-instance_method" title="Puma::Server#handle_servers (method)">handle_servers</a></span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='ivar'>@thread</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_handle_servers'><a href="#handle_servers-instance_method" title="Puma::Server#handle_servers (method)">handle_servers</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stop-instance_method">
  <h3 class='signature '>
    #<strong>stop</strong>(sync = false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Stops the acceptor thread and then causes the worker threads to finish off the request queue before finally exiting.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L604-L607'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='604' data-end='607'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 604</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>(<span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>false</span>)
  <span class='id identifier rubyid_notify_safely'><a href="#notify_safely-instance_method" title="Puma::Server#notify_safely (method)">notify_safely</a></span>(<span class='const'><a href="Const.html#STOP_COMMAND-constant" title="Puma::Const::STOP_COMMAND (constant)">STOP_COMMAND</a></span>)
  <span class='ivar'>@thread</span>.<span class='id identifier rubyid_join'>join</span> <span class='kw'>if</span> <span class='ivar'>@thread</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sync'>sync</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uncork_socket-instance_method">
  <h3 class='signature '>
    #<strong>uncork_socket</strong>(socket)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See additional method definition at line 164.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L176-L183'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='176' data-end='183'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 176</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uncork_socket'>uncork_socket</span>(<span class='id identifier rubyid_socket'>socket</span>)
  <span class='id identifier rubyid_skt'>skt</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_to_io'>to_io</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_setsockopt'>setsockopt</span>(<span class='const'>Socket</span><span class='op'>::</span><span class='const'>IPPROTO_TCP</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>TCP_CORK</span><span class='comma'>,</span> <span class='int'>0</span>) <span class='kw'>if</span> <span class='id identifier rubyid_skt'>skt</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>TCPSocket</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
    <span class='const'><a href="../Puma.html" title="Puma (module)">Puma</a></span><span class='op'>::</span><span class='const'><a href="Util.html" title="Puma::Util (module)">Util</a></span>.<span class='id identifier rubyid_purge_interrupt_queue'><a href="Util.html#purge_interrupt_queue-class_method" title="Puma::Util.purge_interrupt_queue (method)">purge_interrupt_queue</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_force_shutdown-instance_method">
  <h3 class='signature '>
    #<strong>with_force_shutdown</strong>(client, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Triggers a client timeout if the thread-pool shuts down during execution of the provided block.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v6.4.0/lib/puma/server.rb#L498-L502'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='498' data-end='502'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/server.rb', line 498</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_force_shutdown'>with_force_shutdown</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='ivar'>@thread_pool</span>.<span class='id identifier rubyid_with_force_shutdown'>with_force_shutdown</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>rescue</span> <span class='const'><a href="ThreadPool.html" title="Puma::ThreadPool (class)">ThreadPool</a></span><span class='op'>::</span><span class='const'><a href="ThreadPool/ForceShutdown.html" title="Puma::ThreadPool::ForceShutdown (class)">ForceShutdown</a></span>
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout!'>timeout!</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>