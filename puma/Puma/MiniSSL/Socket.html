<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Puma::MiniSSL::Socket &mdash; Puma</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Puma::MiniSSL::Socket",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../index.html'>Puma</a> &raquo; 
      <a href='../../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../../Puma.html" title="Puma (module)">Puma</a> &raquo; 
        <a href="../MiniSSL.html" title="Puma::MiniSSL (module)">MiniSSL</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Socket&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Puma::MiniSSL::Socket</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L10'>lib/puma/minissl.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(socket, engine)  &#x21d2; Socket </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#should_drop_bytes%3F-instance_method" title="#should_drop_bytes? (instance method)">#<strong>should_drop_bytes?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#<<-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>(data)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#write-instance_method" title="Puma::MiniSSL::Socket#write (method)">#write</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#engine_read_all-instance_method" title="#engine_read_all (instance method)">#<strong>engine_read_all</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#flush-instance_method" title="#flush (instance method)">#<strong>flush</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#peeraddr-instance_method" title="#peeraddr (instance method)">#<strong>peeraddr</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#peercert-instance_method" title="#peercert (instance method)">#<strong>peercert</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_and_drop-instance_method" title="#read_and_drop (instance method)">#<strong>read_and_drop</strong>(timeout = 1)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_nonblock-instance_method" title="#read_nonblock (instance method)">#<strong>read_nonblock</strong>(size, *_)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#readpartial-instance_method" title="#readpartial (instance method)">#<strong>readpartial</strong>(size)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#syswrite-instance_method" title="#syswrite (instance method)">#<strong>syswrite</strong>(data)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#write-instance_method" title="Puma::MiniSSL::Socket#write (method)">#write</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_io-instance_method" title="#to_io (instance method)">#<strong>to_io</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write-instance_method" title="#write (instance method)">#<strong>write</strong>(data)  </a>
      (also: #syswrite, #&lt;&lt;)
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write_nonblock-instance_method" title="#write_nonblock (instance method)">#<strong>write_nonblock</strong>(data, *_)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This is a temporary fix to deal with websockets code using write_nonblock.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(socket, engine)  &#x21d2; <code>Socket</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L11-L15'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='11' data-end='15'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='rparen'>)</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span>
  <span class='ivar'>@engine</span> <span class='op'>=</span> <span class='id identifier rubyid_engine'>engine</span>
  <span class='ivar'>@peercert</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="closed?-instance_method">
  <h3 class='signature ro first'>
    #<strong>closed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L21-L23'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='23'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="should_drop_bytes?-instance_method">
  <h3 class='signature ro'>
    #<strong>should_drop_bytes?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L135-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_should_drop_bytes?'>should_drop_bytes?</span>
  <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_init?'>init?</span> <span class='op'>||</span> <span class='op'>!</span><span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="<<-instance_method">
  <h3 class='signature  first'>
    #<strong>&lt;&lt;</strong>(data)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#write-instance_method" title="Puma::MiniSSL::Socket#write (method)">#write</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L107-L107'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='107' data-end='107'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 107</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:&lt;&lt;</span><span class='comma'>,</span> <span class='symbol'>:write</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature '>
    #<strong>close</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L139-L153'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='139' data-end='153'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 139</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='kw'>begin</span>
    <span class='comment'># Read any drop any partially initialized sockets and any received bytes during shutdown.
</span>    <span class='comment'># Don&#39;t let this socket hold this loop forever.
</span>    <span class='comment'># If it can&#39;t send more packets within 1s, then give up.
</span>    <span class='kw'>while</span> <span class='id identifier rubyid_should_drop_bytes?'>should_drop_bytes?</span>
      <span class='kw'>return</span> <span class='kw'>if</span> <span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='comma'>,</span> <span class='symbol'>:eof</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_read_and_drop'>read_and_drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../../IOError.html" title="IOError (class)">IOError</a></span><span class='comma'>,</span> <span class='const'>SystemCallError</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_purge_interrupt_queue'>purge_interrupt_queue</span> <span class='kw'>if</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:purge_interrupt_queue</span>    <span class='comment'># nothing
</span>
  <span class='kw'>ensure</span>
    <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="engine_read_all-instance_method">
  <h3 class='signature '>
    #<strong>engine_read_all</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L42-L48'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='42' data-end='48'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 42</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_engine_read_all'>engine_read_all</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>and</span> <span class='id identifier rubyid_additional_output'>additional_output</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_additional_output'>additional_output</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="flush-instance_method">
  <h3 class='signature '>
    #<strong>flush</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L122-L124'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='122' data-end='124'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 122</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_flush'>flush</span>
  <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="peeraddr-instance_method">
  <h3 class='signature '>
    #<strong>peeraddr</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L155-L157'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='155' data-end='157'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 155</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_peeraddr'>peeraddr</span>
  <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_peeraddr'>peeraddr</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="peercert-instance_method">
  <h3 class='signature '>
    #<strong>peercert</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L159-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='159' data-end='166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 159</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_peercert'>peercert</span>
  <span class='kw'>return</span> <span class='ivar'>@peercert</span> <span class='kw'>if</span> <span class='ivar'>@peercert</span>

  <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_peercert'>peercert</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_raw'>raw</span>

  <span class='ivar'>@peercert</span> <span class='op'>=</span> <span class='const'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_raw'>raw</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_and_drop-instance_method">
  <h3 class='signature '>
    #<strong>read_and_drop</strong>(timeout = 1)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L126-L133'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='126' data-end='133'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 126</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_and_drop'>read_and_drop</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='symbol'>:timeout</span> <span class='kw'>unless</span> <span class='const'><a href="../../IO.html" title="IO (class)">IO</a></span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='ivar'>@socket</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='symbol'>:eof</span> <span class='kw'>unless</span> <span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span>
  <span class='symbol'>:drop</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EAGAIN</span>  <span class='comment'># do nothing
</span>
  <span class='symbol'>:eagain</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_nonblock-instance_method">
  <h3 class='signature '>
    #<strong>read_nonblock</strong>(size, *_)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L50-L82'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='82'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__'>_</span><span class='rparen'>)</span>
  <span class='comment'># *_ is to deal with keyword args that were added
</span>  <span class='comment'># at some point (and being used in the wild)
</span>  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_engine_read_all'>engine_read_all</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>if</span> <span class='id identifier rubyid_output'>output</span>

    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='symbol'>:wait_readable</span> <span class='op'>||</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='symbol'>:wait_writable</span>      <span class='comment'># It would make more sense to let @socket.read_nonblock raise
</span>      <span class='comment'># EAGAIN if necessary but it seems like it&#39;ll misbehave on Windows.
</span>      <span class='comment'># I don&#39;t have a Windows machine to debug this so I can&#39;t explain
</span>      <span class='comment'># exactly whats happening in that OS. Please let me know if you
</span>      <span class='comment'># find out!
</span>      <span class='comment'>#
</span>      <span class='comment'># In the meantime, we can emulate the correct behavior by
</span>      <span class='comment'># capturing :wait_readable &amp; :wait_writable and raising EAGAIN
</span>      <span class='comment'># ourselves.
</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../IO.html" title="IO (class)">IO</a></span><span class='op'>::</span><span class='const'>EAGAINWaitReadable</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='id identifier rubyid_engine_read_all'>engine_read_all</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>if</span> <span class='id identifier rubyid_output'>output</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_neg_data'>neg_data</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_extract'>extract</span>
      <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_neg_data'>neg_data</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="readpartial-instance_method">
  <h3 class='signature '>
    #<strong>readpartial</strong>(size)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L25-L40'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='25' data-end='40'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 25</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_readpartial'>readpartial</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>if</span> <span class='id identifier rubyid_output'>output</span>

    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_readpartial'>readpartial</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span>
    <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span> <span class='kw'>if</span> <span class='id identifier rubyid_output'>output</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_neg_data'>neg_data</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_extract'>extract</span>
      <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_neg_data'>neg_data</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="syswrite-instance_method">
  <h3 class='signature '>
    #<strong>syswrite</strong>(data)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#write-instance_method" title="Puma::MiniSSL::Socket#write (method)">#write</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L106-L106'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='106' data-end='106'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 106</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbol'>:syswrite</span><span class='comma'>,</span> <span class='symbol'>:write</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_io-instance_method">
  <h3 class='signature '>
    #<strong>to_io</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L17-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_io'>to_io</span>
  <span class='ivar'>@socket</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write-instance_method">
  <h3 class='signature '>
    #<strong>write</strong>(data)  
    <span class='aliases'>Also known as: <span class='names'>#syswrite, #&lt;&lt;</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L84-L104'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='84' data-end='104'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 84</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_need'>need</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span>

  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_wrote'>wrote</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_data'>data</span>
    <span class='id identifier rubyid_enc'>enc</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_extract'>extract</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_enc'>enc</span>
      <span class='ivar'>@socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_enc'>enc</span>
      <span class='id identifier rubyid_enc'>enc</span> <span class='op'>=</span> <span class='ivar'>@engine</span><span class='period'>.</span><span class='id identifier rubyid_extract'>extract</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_need'>need</span> <span class='op'>-=</span> <span class='id identifier rubyid_wrote'>wrote</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_bytesize'>bytesize</span> <span class='kw'>if</span> <span class='id identifier rubyid_need'>need</span> <span class='op'>==</span> <span class='int'>0</span>

    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_wrote'>wrote</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_nonblock-instance_method">
  <h3 class='signature '>
    #<strong>write_nonblock</strong>(data, *_)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This is a temporary fix to deal with websockets code using write_nonblock. The problem with implementing it properly is that it means we&#39;d have to have the ability to rewind an engine because after we write+extract, the socket write_nonblock call might raise an exception and later code would pass the same data in, but the engine would think it had already written the data in. So for the time being (and since write blocking is quite rare), go ahead and actually block in write_nonblock.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/puma/puma/blob/v4.3.0/lib/puma/minissl.rb#L118-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='120'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/puma/minissl.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_nonblock'>write_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid__'>_</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>